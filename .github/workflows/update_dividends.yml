  name: Update dividends every hour (KST 8am-8pm)

  on:
    schedule:
      - cron: '0 23,0-11 * * 1-5'  # ë§¤ì£¼ ì›”ìš”ì¼ë¶€í„° ê¸ˆìš”ì¼ê¹Œì§€, KST ê¸°ì¤€ìœ¼ë¡œ ì˜¤ì „ 8ì‹œë¶€í„° ì˜¤í›„ 8ì‹œê¹Œì§€ ë§¤ì‹œê°„ ì‹¤í–‰
    workflow_dispatch:

  permissions:
    contents: write  # âœ… PUSH ê¶Œí•œ ë¶€ì—¬

  jobs:
    update:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Set up Python
          uses: actions/setup-python@v4
          with:
            python-version: '3.10'

        - name: Install dependencies
          run: |
            pip install yfinance

        - name: Fetch dividend data
          # Secrets ì£¼ì…! (ì´ê²Œ ì—†ìœ¼ë©´ KIS API ë¶€ë¶„ì€ ê·¸ëƒ¥ ê±´ë„ˆëœë‹ˆë‹¤)
          env:
            KIS_APP_KEY: ${{ secrets.KIS_APP_KEY }}
            KIS_APP_SECRET: ${{ secrets.KIS_APP_SECRET }}
          run: python scripts/fetch_dividends.py

        - name: Commit and push changes
          run: |
            git config --global user.name 'beajinsu'
            git config --global user.email 'your-email@example.com'
            git add data/dividends.json
            git commit -m "ğŸ”„ ìë™ ì—…ë°ì´íŠ¸: yfinance ë°°ë‹¹ ìˆ˜ìµë¥ " || echo "No changes"
            git push